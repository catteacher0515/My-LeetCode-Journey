# ğŸ“ è‡ªå®šä¹‰æ’åºè£åˆ¤ï¼šComparator æ ¸å¿ƒç¬”è®°ä¸å®æˆ˜

## æ ¸å¿ƒæ€æƒ³

> `Comparator` çš„æ ¸å¿ƒæ€æƒ³æ˜¯**å°†â€œæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„é€»è¾‘â€ä»â€œæ’åºç®—æ³•æœ¬èº«â€ä¸­åˆ†ç¦»å‡ºæ¥**ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯æ’æ‹”çš„ã€ç‹¬ç«‹çš„â€œè§„åˆ™æ‰‹å†Œâ€ï¼Œè®©é€šç”¨çš„æ’åºç®—æ³•ï¼ˆå¦‚ `TimSort`ï¼‰å¯ä»¥å¤„ç†ä»»ä½•ç±»å‹çš„è‡ªå®šä¹‰æ’åºéœ€æ±‚ã€‚

## å…³é”®åˆåŒï¼š`compare` æ–¹æ³•çš„è¿”å›å€¼

è¿™æ˜¯æ‰€æœ‰ `Comparator` çš„åŸºçŸ³ï¼Œæ˜¯ä¸æ’åºç®—æ³•æ²Ÿé€šçš„å”¯ä¸€è¯­è¨€ã€‚

> `int compare(T o1, T o2)`
>
> -   è¿”å›**è´Ÿæ•°** (å¦‚ -1): `o1` æ’åœ¨ `o2` **å‰é¢**ã€‚
> -   è¿”å›**æ­£æ•°** (å¦‚ 1): `o1` æ’åœ¨ `o2` **åé¢**ã€‚
> -   è¿”å›**é›¶ (0)**: `o1` å’Œ `o2` é¡ºåºä¸å˜ï¼ˆä¾èµ–æ’åºç¨³å®šæ€§ï¼‰ã€‚
>
> **æ ¸å¿ƒå£è¯€ï¼šè´Ÿå‰æ­£å (è´Ÿæ•° o1 åœ¨å‰ï¼Œæ­£æ•° o1 åœ¨å)**

---

## ä»é›¶ç¼–å†™ `compare` é€»è¾‘çš„ä¸‰æ­¥å¿ƒæ³•

1.  **æ˜ç¡®â€œå°ºå­â€ (Clarify the "Ruler")**: ä½ è¦æ ¹æ®å“ªä¸ªå±æ€§æ¥æ’åºï¼Ÿï¼ˆä¾‹å¦‚ï¼š`age`, `score`, `length`ï¼‰
2.  **æ˜ç¡®â€œæ–¹å‘â€ (Clarify the "Direction")**: ä½ æƒ³è¦å‡åºè¿˜æ˜¯é™åºï¼Ÿ
3.  **é€‰æ‹©â€œå·¥å…·â€ (Choose the "Tool")**: æ ¹æ®å±æ€§ç±»å‹ï¼Œé€‰æ‹©æœ€åˆé€‚çš„ä»£ç å·¥å…·æ¥è¡¨è¾¾æ¯”è¾ƒã€‚
    -   **æ•°å­—ï¼ˆå‡åºï¼‰**: `Integer.compare(key1, key2)` (æœ€å®‰å…¨) æˆ– `key1 - key2` (æœ‰æº¢å‡ºé£é™©)ã€‚
    -   **æ•°å­—ï¼ˆé™åºï¼‰**: `Integer.compare(key2, key1)` æˆ– `key2 - key1`ã€‚
    -   **å¯¹è±¡/å­—ç¬¦ä¸²ï¼ˆå‡åºï¼‰**: `key1.compareTo(key2)`ã€‚
    -   **å¯¹è±¡/å­—ç¬¦ä¸²ï¼ˆé™åºï¼‰**: `key2.compareTo(key1)`ã€‚
    -   **å¤šçº§æ’åº**: ä½¿ç”¨ `if-else` é€»è¾‘é“¾ï¼Œå…ˆåˆ¤æ–­ä¸»è¦è§„åˆ™ï¼Œè‹¥ç»“æœä¸º `0` å†åˆ¤æ–­æ¬¡è¦è§„åˆ™ã€‚

---

## `Comparator` çš„ä¸‰ç§å®ç°æ–¹å¼

è¿™æ˜¯ Java è¯­æ³•çš„æ¼”è¿›ä¹‹è·¯ï¼Œä»ç¬¨é‡åˆ°ä¼˜é›…ã€‚

#### 1. ç»å…¸æ–¹å¼ï¼šåŒ¿åå†…éƒ¨ç±» (Java 7 åŠä»¥å‰)
æœ€åŸå§‹ã€æœ€å•°å—¦ï¼Œä½†é€»è¾‘æ¸…æ™°ï¼Œé€‚ç”¨äºä»»ä½•å¤æ‚åœºæ™¯ã€‚
```java
list.sort(new Comparator<User>() {
    @Override
    public int compare(User o1, User o2) {
        return o1.getAge() - o2.getAge();
    }
});
````

#### 2\. ç°ä»£æ–¹å¼ï¼šLambda è¡¨è¾¾å¼ (Java 8+)

æ›¿ä»£å‡½æ•°å¼æ¥å£åŒ¿åç±»çš„è¯­æ³•ç³–ï¼Œä»£ç æ›´ç®€æ´ã€‚

```java
list.sort((o1, o2) -> o1.getAge() - o2.getAge());
```

#### 3\. ä¸“ä¸šæ–¹å¼ï¼šé™æ€è¾…åŠ©æ–¹æ³• (Java 8+ï¼Œ**å¼ºçƒˆæ¨è**)

å¯è¯»æ€§æœ€å¼ºã€æœ€å®‰å…¨ã€æœ€çµæ´»çš„å£°æ˜å¼æ–¹æ³•ã€‚

```java
list.sort(Comparator.comparingInt(User::getAge));
```

-----

## é«˜çº§æŠ€å·§ï¼šæ„å»ºå¤æ‚æ’åºè§„åˆ™é“¾

ä½¿ç”¨ `Comparator` çš„é™æ€è¾…åŠ©æ–¹æ³•ï¼Œå¯ä»¥åƒæ­ç§¯æœ¨ä¸€æ ·æ„å»ºä»»æ„å¤æ‚çš„æ’åºé€»è¾‘ã€‚

**åœºæ™¯**ï¼šå…ˆæŒ‰åˆ†æ•°é™åºï¼Œåˆ†æ•°ç›¸åŒæŒ‰åå­—å‡åºï¼Œå¦‚æœè¿åå­—éƒ½å¯èƒ½ä¸º `null`ï¼ŒæŠŠ `null` æ”¾åœ¨æœ€åã€‚

```java
import static java.util.Comparator.*;

Comparator<User> myComplexComparator = 
    comparingInt(User::getScore).reversed()         // 1. æŒ‰åˆ†æ•°é™åº
    .thenComparing(User::getName, nullsLast(naturalOrder())); // 2. ç„¶åæŒ‰åå­—å‡åº, nullåœ¨å

list.sort(myComplexComparator);
```

  - `.reversed()`: å°†å‡åºæ¯”è¾ƒå™¨åè½¬ä¸ºé™åºã€‚
  - `.thenComparing()`: æ·»åŠ æ¬¡çº§æ’åºè§„åˆ™ã€‚
  - `nullsFirst()` / `nullsLast()`: ä¼˜é›…åœ°å¤„ç† `null` å€¼ï¼Œé¿å… `NullPointerException`ã€‚

-----

## ä¸ `Comparable` çš„åŒºåˆ«

è¿™æ˜¯å¦ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œä¸¤è€…ç»å¸¸è¢«æ··æ·†ã€‚

| ç‰¹æ€§ | `Comparable<T>` (å†…éƒ¨æ¯”è¾ƒå™¨) | `Comparator<T>` (å¤–éƒ¨æ¯”è¾ƒå™¨) |
| :--- | :--- | :--- |
| **å®šä¹‰ä½ç½®** | åœ¨**ç±»å®šä¹‰ä¸­**å®ç° (`class User implements Comparable`) | åœ¨**å¤–éƒ¨**ç‹¬ç«‹å®ç° |
| **æ ¸å¿ƒç›®çš„** | å®šä¹‰ä¸€ä¸ªç±»çš„**è‡ªç„¶é¡ºåº**æˆ–**é»˜è®¤é¡ºåº** | å®šä¹‰ä¸€ä¸ªç±»çš„**ç‰¹å®šé¡ºåº**æˆ–**ä¸´æ—¶é¡ºåº** |
| **æ–¹æ³•ç­¾å** | `int compareTo(T other)` (è‡ªå·±å’Œåˆ«äººæ¯”) | `int compare(T o1, T o2)` (è£åˆ¤è¯„åˆ¤ä¸¤è€…) |
| **æ•°é‡** | ä¸€ä¸ªç±»**åªèƒ½æœ‰ä¸€ä¸ª**è‡ªç„¶é¡ºåº | ä¸€ä¸ªç±»å¯ä»¥æœ‰**æ— æ•°ä¸ª**å¤–éƒ¨æ¯”è¾ƒå™¨ |
| **ç±»æ¯”** | äººçš„**èº«é«˜** (ä¸ç”Ÿä¿±æ¥ï¼Œé»˜è®¤çš„æ¯”è¾ƒæ ‡å‡†) | æ¯”èµ›çš„**è§„åˆ™** (ä»Šå¤©æ¯”ä½“é‡ï¼Œæ˜å¤©æ¯”å¹´é¾„) |

-----

-----

## ç†è®ºç»“åˆå®è·µï¼šä¸€ä¸ªå®Œæ•´çš„é‡æ„æ¡ˆä¾‹

ä¸‹é¢æˆ‘ä»¬å°†è¿ç”¨ä¸Šè¿°æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼Œæ¥å®Œæ•´åœ°é‡æ„ä¸€ä¸ªçœŸå®çš„æ’åºéœ€æ±‚ã€‚

### A. æ¡ˆä¾‹åœºæ™¯

æˆ‘ä»¬æœ‰ä¸€ä¸ª `User` ç±»ï¼Œéœ€è¦å¯¹ä¸€ä¸ª `User` åˆ—è¡¨è¿›è¡Œæ’åºã€‚

  - **æ’åºè§„åˆ™**:

    1.  **é¦–è¦è§„åˆ™**ï¼šæŒ‰**ç§¯åˆ† (score) é™åº**æ’åˆ—ï¼ˆåˆ†æ•°é«˜çš„æ’åœ¨å‰é¢ï¼‰ã€‚
    2.  **æ¬¡è¦è§„åˆ™**ï¼šå¦‚æœç§¯åˆ†ç›¸åŒï¼Œåˆ™æŒ‰**ç”¨æˆ·å (name) çš„å­—å…¸åºå‡åº**æ’åˆ—ï¼ˆa, b, c...ï¼‰ã€‚

  - **`User` ç±»å®šä¹‰**:

<!-- end list -->

```java
class User {
    private String name;
    private int score;

    public User(String name, int score) { this.name = name; this.score = score; }
    public String getName() { return name; }
    public int getScore() { return score; }

    @Override
    public String toString() { return name + "{score=" + score + "}"; }
}
```

### B. æ¼”è¿›ä¹‹è·¯

#### é˜¶æ®µä¸€ï¼šåŸå§‹çš„åŒ¿åç±» (Java 7 é£æ ¼)

è¿™æ˜¯æˆ‘ä»¬çš„èµ·ç‚¹ï¼Œä»£ç é€»è¾‘äº¤ç»‡åœ¨ `if-else` ä¸­ï¼Œæ˜¾å¾—éå¸¸ç¬¨é‡ã€‚

```java
import java.util.ArrayList;
import java.util.List;
import java.util.Comparator;

List<User> userList = new ArrayList<>();
userList.add(new User("alice", 90));
userList.add(new User("bob", 100));
userList.add(new User("cathy", 90));

userList.sort(new Comparator<User>() {
    @Override
    public int compare(User u1, User u2) {
        // åº”ç”¨â€œä¸‰æ­¥å¿ƒæ³•â€ï¼šå°ºå­æ˜¯ score/name, æ–¹å‘æ˜¯ é™åº/å‡åº
        if (u1.getScore() != u2.getScore()) {
            // å·¥å…·ï¼šé™åºç”¨ key2 - key1
            return u2.getScore() - u1.getScore(); 
        } else {
            // å·¥å…·ï¼šå‡åºç”¨ key1.compareTo(key2)
            return u1.getName().compareTo(u2.getName());
        }
    }
});

// æœŸæœ›è¾“å‡º: [bob{score=100}, alice{score=90}, cathy{score=90}]
// æ³¨æ„ï¼šalice å’Œ cathy éƒ½æ˜¯90åˆ†ï¼ŒæŒ‰åå­—å­—æ¯åºï¼Œa åœ¨ c å‰é¢ï¼Œæ‰€ä»¥ alice åœ¨ cathy å‰é¢ã€‚
System.out.println(userList);
```

#### é˜¶æ®µäºŒï¼šç°ä»£çš„ Lambda è¡¨è¾¾å¼

æˆ‘ä»¬å¯ä»¥ç”¨ Lambda æ›¿æ¢åŒ¿åå†…éƒ¨ç±»ï¼Œä»£ç è¡Œæ•°å‡å°‘ï¼Œä½†æ ¸å¿ƒçš„ `if-else` é€»è¾‘ä¾ç„¶å­˜åœ¨ã€‚

```java
userList.sort((u1, u2) -> {
    if (u1.getScore() != u2.getScore()) {
        return u2.getScore() - u1.getScore();
    } else {
        return u1.getName().compareTo(u2.getName());
    }
});
```

#### é˜¶æ®µä¸‰ï¼šä¸“ä¸šçš„é™æ€è¾…åŠ©æ–¹æ³•ä¸æ–¹æ³•å¼•ç”¨

è¿™æ‰æ˜¯æœ€ç»ˆçš„ã€æœ€å€¼å¾—æ¨èçš„å½¢æ€ã€‚æˆ‘ä»¬ä¸å†æè¿°â€œå¦‚ä½•åšâ€ï¼Œè€Œæ˜¯å£°æ˜â€œè¦ä»€ä¹ˆâ€ã€‚

```java
userList.sort(
    Comparator.comparingInt(User::getScore).reversed() // è§„åˆ™1: æŒ‰åˆ†æ•°é™åº
              .thenComparing(User::getName)          // è§„åˆ™2: ç„¶åæŒ‰åå­—å‡åº
);
```

### C. æ€»ç»“

| æ¼”è¿›é˜¶æ®µ | ä»£ç ç‰‡æ®µ | ä¼˜ç‚¹/ç¼ºç‚¹ |
| :--- | :--- | :--- |
| **åŒ¿åç±»** | `new Comparator<>() { ... }` | **ä¼˜ç‚¹**: é€»è¾‘é›†ä¸­ï¼Œå…¼å®¹æ€§å¥½ã€‚\<br\>**ç¼ºç‚¹**: æå…¶å•°å—¦ï¼Œå¯è¯»æ€§å·®ã€‚|
| **Lambda** | `(u1, u2) -> { if... }` | **ä¼˜ç‚¹**: æ¯”åŒ¿åç±»ç®€æ´ã€‚\<br\>**ç¼ºç‚¹**: å¤æ‚é€»è¾‘ä¾ç„¶éœ€è¦æ‰‹å†™ `if-else`ã€‚|
| **è¾…åŠ©æ–¹æ³•** | `comparing(...).thenComparing(...)`| **ä¼˜ç‚¹**: æåº¦ç®€æ´ï¼Œå£°æ˜å¼ï¼Œå¯è¯»æ€§å¼ºï¼Œå®‰å…¨ï¼Œæ˜“äºæ‰©å±•ã€‚\<br\>**ç¼ºç‚¹**: éœ€è¦å¯¹ API æœ‰ä¸€å®šäº†è§£ã€‚|

è¿™ä¸ªæ¡ˆä¾‹æ¸…æ™°åœ°å±•ç¤ºäº†ï¼Œ`Comparator` çš„ç°ä»£ç”¨æ³•å¸¦æ¥çš„ä¸ä»…æ˜¯ä»£ç è¡Œæ•°çš„å‡å°‘ï¼Œæ›´æ˜¯ä¸€ç§**æ€ç»´æ–¹å¼çš„è½¬å˜**ï¼šä»**å‘½ä»¤å¼**ï¼ˆå‘Šè¯‰è®¡ç®—æœºâ€œå¦‚ä½•â€åš `if-else`ï¼‰è½¬å˜ä¸º**å£°æ˜å¼**ï¼ˆå‘Šè¯‰è®¡ç®—æœºæˆ‘â€œæƒ³è¦ä»€ä¹ˆâ€æ ·çš„æ’åºè§„åˆ™ï¼‰ã€‚

```
```
